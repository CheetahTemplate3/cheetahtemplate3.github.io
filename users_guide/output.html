
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generating, Caching and Filtering Output &#8212; Cheetah3 - The Python-Powered Template Engine</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Import, Inheritance, Declaration and Assignment" href="inheritanceEtc.html" />
    <link rel="prev" title="Comments" href="comments.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="inheritanceEtc.html" title="Import, Inheritance, Declaration and Assignment"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="comments.html" title="Comments"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Cheetah3 - The Python-Powered Template Engine</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Cheetah User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Generating, Caching and Filtering Output</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generating-caching-and-filtering-output">
<h1>Generating, Caching and Filtering Output<a class="headerlink" href="#generating-caching-and-filtering-output" title="Permalink to this heading">¶</a></h1>
<div class="section" id="output-from-complex-expressions-echo">
<h2>Output from complex expressions: #echo<a class="headerlink" href="#output-from-complex-expressions-echo" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#echo EXPR</span>
</pre></div>
</div>
<p>The {#echo} directive is used to echo the output from expressions
that can’t be written as simple $placeholders.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span> <span class="ow">is</span> <span class="n">my</span> <span class="c1">#echo &#39;, &#39;.join([&#39;silly&#39;]*5) # example</span>
</pre></div>
</div>
<p>This produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">silly</span><span class="p">,</span> <span class="n">silly</span><span class="p">,</span> <span class="n">silly</span><span class="p">,</span> <span class="n">silly</span><span class="p">,</span> <span class="n">silly</span> <span class="n">example</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-expressions-without-output-silent">
<h2>Executing expressions without output: #silent<a class="headerlink" href="#executing-expressions-without-output-silent" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#silent EXPR</span>
</pre></div>
</div>
<p>{#silent} is the opposite of {#echo}. It executes an expression but
discards the output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#silent $myList.reverse()</span>
<span class="c1">#silent $myList.sort()</span>
<span class="n">Here</span> <span class="ow">is</span> <span class="c1">#silent $covertOperation() # nothing</span>
</pre></div>
</div>
<p>If your template requires some Python code to be executed at the
beginning; (e.g., to calculate placeholder values, access a
database, etc), you can put it in a “doEverything” method you
inherit, and call this method using {#silent} at the top of the
template.</p>
</div>
<div class="section" id="one-line-if">
<h2>One-line #if<a class="headerlink" href="#one-line-if" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if EXPR1 then EXPR2 else EXPR3#</span>
</pre></div>
</div>
<p>The {#if} flow-control directive (section flowControl.if) has a
one-line counterpart akin to Perl’s and C’s {?:} operator. If
{EXPR1} is true, it evaluates {EXPR2} and outputs the result (just
like {#echo EXPR2#}). Otherwise it evaluates {EXPR3} and outputs
that result. This directive is short-circuiting, meaning the
expression that isn’t needed isn’t evaluated.</p>
<p>You MUST include both ‘then’ and ‘else’. If this doesn’t work for
you or you don’t like the style use multi-line {#if} directives
(section flowControl.if).</p>
<p>The trailing {#} is the normal end-of-directive character. As usual
it may be omitted if there’s nothing after the directive on the
same line.</p>
</div>
<div class="section" id="caching-output">
<h2>Caching Output<a class="headerlink" href="#caching-output" title="Permalink to this heading">¶</a></h2>
<div class="section" id="caching-individual-placeholders">
<h3>Caching individual placeholders<a class="headerlink" href="#caching-individual-placeholders" title="Permalink to this heading">¶</a></h3>
<p>By default, the values of each $placeholder is retrieved and
interpolated for every request. However, it’s possible to cache the
values of individual placeholders if they don’t change very often,
in order to speed up the template filling.</p>
<p>To cache the value of a single {$placeholder}, add an asterisk
after the $; e.g., {$*var}. The first time the template is filled,
{$var} is looked up. Then whenever the template is filled again,
the cached value is used instead of doing another lookup.</p>
<p>The {$*} format caches “forever”; that is, as long as the template
instance remains in memory. It’s also possible to cache for a
certain time period using the form {$*&lt;interval&gt;*variable}, where
{&lt;interval&gt;} is the interval. The time interval can be specified in
seconds (5s), minutes (15m), hours (3h), days (2d) or weeks (1.5w).
The default is minutes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;HTML&gt;
&lt;HEAD&gt;&lt;TITLE&gt;$title&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY&gt;

$var ${var}           ## dynamic - will be reinterpolated for each request
$*var2 $*{var2}       ## static - will be interpolated only once at start-up
$*5*var3 $*5*{var3}   ## timed refresh - will be updated every five minutes.

&lt;/BODY&gt;
&lt;/HTML&gt;
</pre></div>
</div>
<p>Note that “every five minutes” in the example really means every
five minutes: the variable is looked up again when the time limit
is reached, whether the template is being filled that frequently or
not. Keep this in mind when setting refresh times for CPU-intensive
or I/O intensive operations.</p>
<p>If you’re using the long placeholder syntax, <code class="docutils literal notranslate"><span class="pre">${}</span></code>, the braces go
only around the placeholder name: <code class="docutils literal notranslate"><span class="pre">$*.5h*{var.func('arg')}</span></code>.</p>
<p>Sometimes it’s preferable to explicitly invalidate a cached item
whenever you say so rather than at certain time intervals. You
can’t do this with individual placeholders, but you can do it with
cached regions, which will be described next.</p>
</div>
<div class="section" id="caching-entire-regions">
<h3>Caching entire regions<a class="headerlink" href="#caching-entire-regions" title="Permalink to this heading">¶</a></h3>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cache [id=EXPR] [timer=EXPR] [test=EXPR]</span>
<span class="c1">#end cache</span>
</pre></div>
</div>
<p>The {#cache} directive is used to cache a region of content in a
template. The region is cached as a single unit, after placeholders
and directives inside the region have been evaluated. If there are
any {$*&lt;interval&gt;*var} placholders inside the cache region, they
are refreshed only when { both} the cache region { and} the
placeholder are simultaneously due for a refresh.</p>
<p>Caching regions offers more flexibility than caching individual
placeholders. You can specify the refresh interval using a
placeholder or expression, or refresh according to other criteria
rather than a certain time interval.</p>
<p>{#cache} without arguments caches the region statically, the same
way as {$*var}. The region will not be automatically refreshed.</p>
<p>To refresh the region at an interval, use the {timer=EXPRESSION}
argument, equivalent to {$*&lt;interval&gt;*}. The expression should
evaluate to a number or string that is a valid interval (e.g., 0.5,
‘3m’, etc).</p>
<p>To refresh whenever an expression is true, use {test=EXPRESSION}.
The expression can be a method/function returning true or false, a
boolean placeholder, several of these joined by {and} and/or {or},
or any other expression. If the expression contains spaces, it’s
easier to read if you enclose it in {()}, but this is not
required.</p>
<p>To refresh whenever you say so, use {id=EXPRESSION}. Your program
can then call {.refreshCache(ID)} whenever it wishes. This is
useful if the cache depends on some external condition that changes
infrequently but has just changed now.</p>
<p>You can combine arguments by separating them with commas. For
instance, you can specify both {id=} and {interval=}, or {id=} and
{test=}. (You can also combine interval and test although it’s not
very useful.) However, repeating an argument is undefined.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#cache
This is a static cache.  It will not be refreshed.
$a $b $c
#end cache

#cache timer=&#39;30m&#39;, id=&#39;cache1&#39;
#for $cust in $customers
$cust.name:
$cust.street - $cust.city
#end for
#end cache

#cache id=&#39;sidebar&#39;, test=$isDBUpdated
... left sidebar HTML ...
#end cache

#cache id=&#39;sidebar2&#39;, test=($isDBUpdated or $someOtherCondition)
... right sidebar HTML ...
#end cache
</pre></div>
</div>
<p>The {#cache} directive cannot be nested.</p>
<p>We are planning to add a {‘varyBy’} keyword argument in the future
that will allow a separate cache instances to be created for a
variety of conditions, such as different query string parameters or
browser types. This is inspired by ASP.net’s varyByParam and
varyByBrowser output caching keywords.</p>
</div>
</div>
<div class="section" id="raw">
<h2>#raw<a class="headerlink" href="#raw" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#raw</span>
<span class="c1">#end raw</span>
</pre></div>
</div>
<p>Any section of a template definition that is inside a {#raw …
#end raw} tag pair will be printed verbatim without any parsing of
$placeholders or other directives. This can be very useful for
debugging, or for Cheetah examples and tutorials.</p>
<p>{#raw} is conceptually similar to HTML’s {&lt;PRE&gt;} tag and LaTeX’s {
verbatim{}} tag, but unlike those tags, {#raw} does not cause the
body to appear in a special font or typeface. It can’t, because
Cheetah doesn’t know what a font is.</p>
</div>
<div class="section" id="include">
<h2>#include<a class="headerlink" href="#include" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include [raw] FILENAME_EXPR</span>
<span class="c1">#include [raw] source=STRING_EXPR</span>
</pre></div>
</div>
<p>The {#include} directive is used to include text from outside the
template definition. The text can come from an external file or
from a {$placeholder} variable. When working with external files,
Cheetah will monitor for changes to the included file and update as
necessary.</p>
<p>This example demonstrates its use with external files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;includeFileName.txt&quot;</span>
</pre></div>
</div>
<p>The content of “includeFileName.txt” will be parsed for Cheetah
syntax.</p>
<p>And this example demonstrates use with {$placeholder} variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include source=$myParseText</span>
</pre></div>
</div>
<p>The value of {$myParseText} will be parsed for Cheetah syntax. This
is not the same as simply placing the $placeholder tag
“{$myParseText}” in the template definition. In the latter case,
the value of $myParseText would not be parsed.</p>
<p>By default, included text will be parsed for Cheetah tags. The
argument “{raw}” can be used to suppress the parsing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include raw &quot;includeFileName.txt&quot;</span>
<span class="c1">#include raw source=$myParseText</span>
</pre></div>
</div>
<p>Cheetah wraps each chunk of {#include} text inside a nested
{Template} object. Each nested template has a copy of the main
template’s searchList. However, {#set} variables are visible across
includes only if the defined using the {#set global} keyword.</p>
<p>All directives must be balanced in the include file. That is, if
you start a {#for} or {#if} block inside the include, you must end
it in the same include. (This is unlike PHP, which allows
unbalanced constructs in include files.)</p>
</div>
<div class="section" id="slurp">
<h2>#slurp<a class="headerlink" href="#slurp" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#slurp</span>
</pre></div>
</div>
<p>The {#slurp} directive eats up the trailing newline on the line it
appears in, joining the following line onto the current line.</p>
<p>It is particularly useful in {#for} loops:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#for $i in range(5)
$i #slurp
#end for
</pre></div>
</div>
<p>outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="indent">
<h2>#indent<a class="headerlink" href="#indent" title="Permalink to this heading">¶</a></h2>
<p>This directive is not implemented yet. When/if it’s completed, it
will allow you to</p>
<ol class="arabic simple">
<li><p>indent your template definition in a natural way (e.g., the
bodies of {#if} blocks) without affecting the output</p></li>
<li><p>add indentation to output lines without encoding it literally in
the template definition. This will make it easier to use Cheetah to
produce indented source code programmatically (e.g., Java or Python
source code).</p></li>
</ol>
<p>There is some experimental code that recognizes the {#indent}
directive with options, but the options are purposely undocumented
at this time. So pretend it doesn’t exist. If you have a use for
this feature and would like to see it implemented sooner rather
than later, let us know on the mailing list.</p>
<p>The latest specification for the future {#indent} directive is in
the TODO file in the Cheetah source distribution.</p>
</div>
<div class="section" id="ouput-filtering-and-filter">
<h2>Ouput Filtering and #filter<a class="headerlink" href="#ouput-filtering-and-filter" title="Permalink to this heading">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#filter FILTER_CLASS_NAME</span>
<span class="c1">#filter $PLACEHOLDER_TO_A_FILTER_INSTANCE</span>
<span class="c1">#filter None</span>
</pre></div>
</div>
<p>Output from $placeholders is passed through an ouput filter. The
default filter merely returns a string representation of the
placeholder value, unless the value is {None}, in which case the
filter returns an empty string. Only top-level placeholders invoke
the filter; placeholders inside expressions do not.</p>
<p>Certain filters take optional arguments to modify their behaviour.
To pass arguments, use the long placeholder syntax and precede each
filter argument by a comma. By convention, filter arguments don’t
take a {$} prefix, to avoid clutter in the placeholder tag which
already has plenty of dollar signs. For instance, the MaxLen filter
takes an argument ‘maxlen’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${placeholderName, maxlen=20}
${functionCall($functionArg), maxlen=$myMaxLen}
</pre></div>
</div>
<p>To change the output filter, use the {‘filter’} keyword to the
{Template} class constructor, or the {#filter} directive at runtime
(details below). You may use {#filter} as often as you wish to
switch between several filters, if certain {$placeholders} need one
filter and other {$placeholders} need another.</p>
<p>The standard filters are in the module {Cheetah.Filters}. Cheetah
currently provides:</p>
<blockquote>
<div><p>The default filter, which converts None to ‘’ and everything else
to {str(whateverItIs)}. This is the base class for all other
filters, and the minimum behaviour for all filters distributed with
Cheetah.</p>
<p>Same.</p>
<p>Same, but truncate the value if it’s longer than a certain length.
Use the ‘maxlen’ filter argument to specify the length, as in the
examples above. If you don’t specify ‘maxlen’, the value will not
be truncated.</p>
<p>Output a “pageful” of a long string. After the page, output HTML
hyperlinks to the previous and next pages. This filter uses several
filter arguments and environmental variables, which have not been
documented yet.</p>
<p>Same as default, but convert HTML-sensitive characters
(‘<span class="math">$<$</span>’, ‘&amp;’, ‘<span class="math">$>$</span>’) to HTML entities so that the
browser will display them literally rather than interpreting them
as HTML tags. This is useful with database values or user input
that may contain sensitive characters. But if your values contain
embedded HTML tags you want to preserve, you do not want this
filter.</p>
<p>The filter argument ‘also’ may be used to specify additional
characters to escape. For instance, say you want to ensure a value
displays all on one line. Escape all spaces in the value with
‘&amp;nbsp’, the non-breaking space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${$country, also=&#39; &#39;}}
</pre></div>
</div>
</div></blockquote>
<p>To switch filters using a class object, pass the class using the {
filter} argument to the Template constructor, or via a placeholder
to the {#filter} directive: {#filter $myFilterClass}. The class
must be a subclass of {Cheetah.Filters.Filter}. When passing a
class object, the value of { filtersLib} does not matter, and it
does not matter where the class was defined.</p>
<p>To switch filters by name, pass the name of the class as a string
using the { filter} argument to the Template constructor, or as a
bare word (without quotes) to the {#filter} directive: {#filter
TheFilter}. The class will be looked up in the { filtersLib}.</p>
<p>The filtersLib is a module containing filter classes, by default
{Cheetah.Filters}. All classes in the module that are subclasses of
{Cheetah.Filters.Filter} are considered filters. If your filters
are in another module, pass the module object as the { filtersLib}
argument to the Template constructor.</p>
<p>Writing a custom filter is easy: just override the {.filter}
method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>     <span class="c1"># Returns a string.</span>
</pre></div>
</div>
<p>Return the { string} that should be output for ‘val’. ‘val’ may be
any type. Most filters return `’ for {None}. Cheetah passes one
keyword argument: <code class="docutils literal notranslate"><span class="pre">kw['rawExpr']</span></code> is the placeholder name as it
appears in the template definition, including all subscripts and
arguments. If you use the long placeholder syntax, any options you
pass appear as keyword arguments. Again, the return value must be a
string.</p>
<p>You can always switch back to the default filter this way: {#filter
None}. This is easy to remember because “no filter” means the
default filter, and because None happens to be the only object the
default filter treats specially.</p>
<p>We are considering additional filters; see
<a class="reference external" href="http://webware.colorstudy.net/twiki/bin/view/Cheetah/MoreFilters">http://webware.colorstudy.net/twiki/bin/view/Cheetah/MoreFilters</a>
for the latest ideas.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Generating, Caching and Filtering Output</a><ul>
<li><a class="reference internal" href="#output-from-complex-expressions-echo">Output from complex expressions: #echo</a></li>
<li><a class="reference internal" href="#executing-expressions-without-output-silent">Executing expressions without output: #silent</a></li>
<li><a class="reference internal" href="#one-line-if">One-line #if</a></li>
<li><a class="reference internal" href="#caching-output">Caching Output</a><ul>
<li><a class="reference internal" href="#caching-individual-placeholders">Caching individual placeholders</a></li>
<li><a class="reference internal" href="#caching-entire-regions">Caching entire regions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#raw">#raw</a></li>
<li><a class="reference internal" href="#include">#include</a></li>
<li><a class="reference internal" href="#slurp">#slurp</a></li>
<li><a class="reference internal" href="#indent">#indent</a></li>
<li><a class="reference internal" href="#ouput-filtering-and-filter">Ouput Filtering and #filter</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="comments.html"
                          title="previous chapter">Comments</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="inheritanceEtc.html"
                          title="next chapter">Import, Inheritance, Declaration and Assignment</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/output.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="inheritanceEtc.html" title="Import, Inheritance, Declaration and Assignment"
             >next</a> |</li>
        <li class="right" >
          <a href="comments.html" title="Comments"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Cheetah3 - The Python-Powered Template Engine</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Cheetah User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Generating, Caching and Filtering Output</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2022, Oleg Broytman; 2009-2012, R. Tyler Croy; 2001-2008, The Cheetah Development Team..
      Last updated on Oct 03, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>